$roleAssignments = Get-AzRoleAssignment -ObjectId $ObjectId -Scope $Scope | Where-Object {
    $_.RoleDefinitionName -eq $RoleDefinitionName
}

if (-not $roleAssignments) {
    Write-Output "No matching role assignments found directly at the specified scope."
} else {
    foreach ($assignment in $roleAssignments) {
        Write-Output "Attempting to remove role assignment at scope: $($assignment.Scope)"
        try {
            Remove-AzRoleAssignment `
              -ObjectId $assignment.ObjectId `
              -Scope $assignment.Scope `
              -RoleDefinitionName $assignment.RoleDefinitionName `
              -Verbose

            Write-Output "Removed successfully."
        } catch {
            Write-Error "Failed to remove role assignment: $_"
        }
    }
}
